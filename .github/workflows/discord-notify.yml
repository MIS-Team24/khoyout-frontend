name: Notify Discord on Push

on:
  push:
    branches:
      - dev
    paths-ignore:
      - '.github/workflows/discord-notify.yml'

jobs:
  notify:
    if: "!contains(github.event.head_commit.message, '[ci skip]')"  # Skip commits with [ci skip]
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Install jq
      run: sudo apt-get install -y jq

    - name: Load user photo URL
      id: load_photo
      run: |
        PHOTO_URL=$(jq -r --arg user "${{ github.actor }}" '.[$user]' .github/user_photos.json)
        echo "PHOTO_URL=$PHOTO_URL" >> $GITHUB_ENV
        echo "Loaded photo URL: $PHOTO_URL"

    - name: Send notification to Discord
      env:
        DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        GITHUB_ACTOR: ${{ github.actor }}
        PHOTO_URL: ${{ env.PHOTO_URL }}
      run: |
        SHORT_COMMIT=$(git rev-parse --short HEAD)
        COMMIT_INFO=$(git log -1 --pretty=format:"%h - %an: %s")
        MESSAGES=("ğŸš€ Fantastic work, $GITHUB_ACTOR! ğŸš€  You've just pushed another commit: \`\`\` $COMMIT_INFO \`\`\`   Your dedication is really making a difference!  ğŸŒŸ Keep the momentum going and let's push even harder.  Our deadline on **6/6** is fast approaching, and with your continuous efforts, we're sure to achieve our goals!   **Let's crush this together! ğŸ’ª**  Check the latest updates on [our website](https://khoyout.live/).  b383d90 $SHORT_COMMIT"
                  "ğŸ’¥ Amazing job, $GITHUB_ACTOR! ğŸ’¥ Another commit pushed: \`\`\` $COMMIT_INFO \`\`\` Your hard work is paying off! ğŸŒŸ Stay focused and let's keep pushing. The deadline on **6/6** is just around the corner. Together, we can do this! **Keep it up! ğŸ”¥**  Check the latest updates on [our website](https://khoyout.live/).  b383d90 $SHORT_COMMIT"
                  "ğŸŒŸ Excellent work, $GITHUB_ACTOR! ğŸŒŸ You've committed: \`\`\` $COMMIT_INFO \`\`\` Your effort is truly inspiring! Let's continue this momentum and achieve our goals by **6/6**. **You're doing great! ğŸ’ª**  Check the latest updates on [our website](https://khoyout.live/).  b383d90 $SHORT_COMMIT"
                  "âœ¨ Awesome job, $GITHUB_ACTOR! âœ¨ New commit: \`\`\` $COMMIT_INFO \`\`\` Your contributions are invaluable! Let's maintain this pace and aim for our deadline on **6/6**. **Keep shining! ğŸŒŸ**  Check the latest updates on [our website](https://khoyout.live/).  b383d90 $SHORT_COMMIT"
                  "ğŸ”¥ Incredible work, $GITHUB_ACTOR! ğŸ”¥ You've added: \`\`\` $COMMIT_INFO \`\`\` Your dedication is impressive! Let's keep this up and hit our deadline on **6/6**. **Together, we're unstoppable! ğŸ’ª**  Check the latest updates on [our website](https://khoyout.live/).  b383d90 $SHORT_COMMIT"
                  "ğŸ‰ Great job, $GITHUB_ACTOR! ğŸ‰ Another commit in the books: \`\`\` $COMMIT_INFO \`\`\` Your commitment is driving us forward! Let's push even harder and reach our goals by **6/6**. **We got this! ğŸš€**  Check the latest updates on [our website](https://khoyout.live/).  b383d90 $SHORT_COMMIT"
                  "ğŸ‘ Fantastic effort, $GITHUB_ACTOR! ğŸ‘ New commit pushed: \`\`\` $COMMIT_INFO \`\`\` Your hard work is making a huge impact! Let's continue this drive and meet our deadline on **6/6**. **Keep going strong! ğŸ’ª**  Check the latest updates on [our website](https://khoyout.live/).  b383d90 $SHORT_COMMIT"
                  "ğŸŒ  Stellar work, $GITHUB_ACTOR! ğŸŒ  Committed: \`\`\` $COMMIT_INFO \`\`\` Your dedication is shining through! Let's keep the momentum and reach our goals by **6/6**. **You rock! ğŸ¤˜**  Check the latest updates on [our website](https://khoyout.live/).  b383d90 $SHORT_COMMIT"
                  "ğŸš€ Superb job, $GITHUB_ACTOR! ğŸš€ You've pushed: \`\`\` $COMMIT_INFO \`\`\` Your efforts are pushing us forward! Let's stay focused and achieve our targets by **6/6**. **Keep it up, champ! ğŸ’ª**  Check the latest updates on [our website](https://khoyout.live/).  b383d90 $SHORT_COMMIT"
                  "ğŸ¯ Excellent effort, $GITHUB_ACTOR! ğŸ¯ New commit: \`\`\` $COMMIT_INFO \`\`\` Your dedication is truly appreciated! Let's keep pushing towards our deadline on **6/6**. **Together, we can do it! ğŸš€**  Check the latest updates on [our website](https://khoyout.live/).  b383d90 $SHORT_COMMIT")
        RANDOM_INDEX=$((RANDOM % ${#MESSAGES[@]}))
        MOTIVATIONAL_MESSAGE=${MESSAGES[$RANDOM_INDEX]}
        PAYLOAD=$(jq -n --arg content "New push to branch \`${{ github.ref_name }}\`: $MOTIVATIONAL_MESSAGE" \
                      --arg image_url "$PHOTO_URL" \
                      '{username: "Git Bot", content: $content, embeds: [{image: {url: $image_url}}]}')
        curl -H "Content-Type: application/json" -X POST -d "$PAYLOAD" $DISCORD_WEBHOOK_URL